<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:dvn="/WEB-INF/tlds/dvn-components"
      xmlns:ice="http://www.icesoft.com/icefaces/component">
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    </h:head>
    <h:body>
        <ui:composition template="/template.xhtml">
            <ui:param name="pageTitle" value="#{VDCRequest.dataversePageTitle}"/>
            <ui:define name="metadata">
                <f:metadata>
                    <f:event type="preRenderView"
                             listener="#{homePage.preRenderView}"/>
                </f:metadata>
            </ui:define>
            <ui:define name="body">
                <f:loadBundle basename="Bundle" var="bundle"/>
                <f:loadBundle basename="BundleAnalysis" var="bundleAnalysis"/>
                <ice:form id="form1">
                    <ice:inputHidden id="vdcId" value="#{VDCRequest.currentVDCId}"/>
                    <!-- Success Message -->
                    <div jsfc="ice:panelGroup" styleClass="#{homePage.msg.styleClass}" rendered="#{!empty homePage.msg.messageText}">
                        <ice:outputText id="statusMessage" escape="false" value="#{homePage.msg.messageText}"/>
                    </div>
                    <!-- Search -->
                    <div id="dvnHomePgSearch">
                        <div class="dvnSearchBlock">
                            <ui:include src="BasicSearchFragment.xhtml"></ui:include>

                            <div class="dvn_searchlinks">
                                <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/AdvSearchPage.xhtml">
                                    <ice:outputText value="Advanced Search"/>
                                </ice:outputLink>
                                <ice:outputLink value="http://guides.thedata.org/book/search" target="_blank">
                                    <ice:outputText value="Tips"/>
                                </ice:outputLink>
                            </div>
                        </div>
                    </div>
                    <!-- Search End -->
                    <!-- Main Section starts here -->
                    <div id="dvn_mainSection">
                        <div jsfc="ice:panelGroup" styleClass="dvn_hmpgMainMessage" rendered="#{(VDCRequest.vdcNetwork.displayAnnouncements == true) and (VDCRequest.currentVDC == null) }" id="networkAnnouncementsHeaderPanel" >
                            <ice:outputText id="networkAnnouncementsMessages" escape="false" value="#{homePage.parsedNetworkAnnouncements}"/>
                        </div>
                    </div>
                    <!-- Main Section ends here -->
                    <div id="hiddenDiv">
                        <ice:outputText value="#{NetworkStatsBean.autoLoad}"/>
                    </div>
                    <!-- ***************** NETWORK HOMEPAGE CONTENT *************************  -->
                    
                    <!-- EMPTY DVN -->
                    <div jsfc="ice:panelGroup" styleClass="dvnHmpgGroupNoDVs" rendered="#{homePage.vdcUIListSize == 0}">
                        <p><ice:outputText value="There are no dataverses to display for the selected filter. Please select again."/></p>
                    </div>
                    
                    <!-- Dataverses + Studies Container -->
                    <div jsfc="ice:panelGroup" rendered="#{homePage.vdcUIListSize != 0}" style="overflow:hidden;">
                            <!-- Dataverses -->
                            <div jsfc="ice:panelGroup" styleClass="dvn_section dvn_overflow" style="float:left; width:48%; padding-right:2%; margin-top:0;">
                                <div style="text-align:left;">
                                    <div style="overflow:hidden; margin-bottom:.5em; border-bottom:1px solid #C55B28;">
                                        <h1 style="float:left; margin:0; padding:6px 0; color:#C55B28;">Dataverses</h1>

                                        <ice:outputLink style="float:left; margin-left:2em; padding:6px 0;" value="/dvn/faces/site/BrowseDataversesPage.xhtml" id="hyperlinkBrowseDV">
                                            <ice:outputText value="View All "/>
                                            <ice:outputText styleClass="dvn_totalsValue" value="#{homePage.vdcUIListSize}"/>
                                            <ice:outputText value=" Dataverses"/>
                                        </ice:outputLink>
                                        
                                        <div jsfc="ice:panelGroup" style="float:right;" id="createDataverse" styleClass="dvhmpgactionbox" rendered="#{VDCRequest.vdcNetwork.allowCreateRequest and !VDCRequest.readOnlyDatabase}">
                                            <ice:outputLink value="/dvn/faces/login/CreatorRequestInfoPage.xhtml">
                                                <ice:outputText value="Create a Dataverse"/>
                                            </ice:outputLink>
                                        </div>
                                    </div>
                                    
                                    <div>Dataverse is a virtual web archive that contains data studies and can be customized by and managed by its administrator or owner. Archiving with the dataverse could extend the useful life of data, preserving it against the failure of computer systems and the obsolescence of data formats.</div>
                                    
                                    <div id="dvClassificationMenu" class="xtraMenu basic">
                                                        
                                        <ui:repeat rendered="#{homePage.accordionItemBeans != null}"
                                                value="#{homePage.accordionItemBeans}"
                                                var="menuItems">
                                            <ui:fragment rendered="#{!empty(menuItems.childItems)}">
                                                <h3 class="head">
                                                    <ice:outputText value="Browse Dataverses By #{menuItems.name}"/>
                                                </h3>
                                                <ul class="head-top">
                                                <ui:repeat rendered="#{menuItems != null}"
                                                        value="#{menuItems.childItems}"
                                                        var="item">
                                                    <!-- HAS SUBNODE DESCENDANTS -->
                                                    <ui:fragment rendered="#{!empty(item.xtraItems)}">
                                                        <li id="xtraMenu#{item.id}">
                                                            <h4 class="head">
                                                                <ice:outputLink styleClass="head" value="/dvn/faces/site/BrowseDataversesPage.xhtml?groupId=#{item.id}"                                                                                                                                                                                                                    >
                                                                    <ice:outputText value="#{item.name}"/>
                                                                </ice:outputLink>                                              
                                                            </h4>
                                                            <ui:fragment rendered="#{item.xtraItems != null and !empty(item.xtraItems)}">
                                                                <ul>
                                                                    <ui:repeat rendered="#{item.xtraItems != null}"
                                                                            value="#{item.xtraItems}"
                                                                            var="xtraItems">
                                                                        <li>
                                                                            <ice:outputLink styleClass="lastNode" value="/dvn/faces/site/BrowseDataversesPage.xhtml?groupId=#{xtraItems.id}">
                                                                                <ice:outputText value="#{xtraItems.name}"/>
                                                                            </ice:outputLink>
                                                                            <ice:outputText value=" (#{xtraItems.numberOfDataverses})" styleClass="dvnHmpgClassificationCount"/>
                                                                        </li>
                                                                    </ui:repeat>
                                                                </ul>
                                                            </ui:fragment>
                                                        </li>
                                                    </ui:fragment>
                                                    <!-- END HAS SUBNODE DESCENDANTS -->
                                                    <!-- HAS NO SUBNODE DESCENDANTS -->
                                                    <ui:fragment rendered="#{empty(item.xtraItems)}">
                                                        <li>
                                                            <ice:outputLink styleClass="lastNode" value="/dvn/faces/site/BrowseDataversesPage.xhtml?groupId=#{item.id}">
                                                                <ice:outputText value="#{item.name}"/>
                                                            </ice:outputLink>
                                                            <ice:outputText value=" (#{item.numberOfDataverses})" styleClass="dvnHmpgClassificationCount"/>
                                                        </li>
                                                    </ui:fragment>
                                                    <!-- END HAS NO SUBNODE DESCENDANTS -->
                                                </ui:repeat>
                                                </ul>
                                            </ui:fragment>
                                        </ui:repeat>
                                        
                                    </div>
                                    
                                    <div jsfc="ice:panelGroup" style="margin-top:1em; border-bottom: 1px solid #C55B28;" rendered="#{!empty homePage.mostRecentlyReleasedDVs}">
                                        <div style="color:#C55B28; text-transform:uppercase;">Recently Released Dataverses</div>
                                        <ice:dataTable headerClass="groupRow" id="recentDataverseList"
                                                    rendered="#{!empty(homePage.mostRecentlyReleasedDVs)}"
                                                    rows="10" width="100%" 
                                                    styleClass="dvnHmpgDataverseWidgetTable"
                                                    value="#{homePage.mostRecentlyReleasedDVs}" var="vdcUI">
                                            <ice:column>
                                                <ice:outputLink styleClass="dvnHmpgDvNameLink dvnInlineHelpTip" id="dataverse_link" value="/dvn/dv/#{vdcUI.vdc.alias}"
                                                                title="#{vdcUI.name} Dataverse - Released: #{vdcUI.releaseDate}
                                                                        #{!empty(vdcUI.vdc.affiliation) ? '&lt;br/&gt;Affilitation:  ' : ''} #{vdcUI.vdc.affiliation}
                                                                        #{!empty(vdcUI.vdc.dvnDescription) ? '&lt;br/&gt;Description: ' : ''} #{vdcUI.vdc.dvnDescription}">
                                                    <ice:outputText style="font-size:90% !important;" value="#{vdcUI.name}"/>
                                                </ice:outputLink>
                                            </ice:column>
                                        </ice:dataTable>
                                        <div style="text-align:center; padding:3px 5px">
                                            <ice:outputLink value="/dvn/faces/site/BrowseDataversesPage.xhtml?initialSort=Released" >
                                                <ice:outputText style="text-align:center; font-size:90% !important;" value="View More &gt;"/>                          
                                            </ice:outputLink>
                                        </div>
                                    </div>
                                    
                                </div>
                                
                            </div>
                            <!-- Dataverses End -->
                            
                            <!-- Studies -->
                            <div style="float:left; width:48%; padding-left:2%;">
                                <div style="text-align:left;">
                                    <div style="overflow:hidden; margin-bottom:.5em; border-bottom:1px solid #526F76;">
                                        <h1 style="float:left; margin:0; padding:6px 0; color:#526F76;">Studies</h1>
                                        <div jsfc="ice:panelGroup" style="float:left; padding:6px 0; margin-left:2em;"
                                             rendered="#{!empty(homePage.vdcUIList.vdcUIList) and VDCRequest.currentVDC == null}">
                                            <ice:outputLink value="/dvn/faces/StudyListingPage.xhtml?mode=100" id="hyperlinkBrowseStudies">
                                                <ice:outputText value="View All "/>
                                                <ice:outputText rendered="#{homePage.groupName == 'Released Dataverses' and homePage.isAlphaSort == false}"
                                                                styleClass="dvn_totalsValue"
                                                                value="#{homePage.studyCount}"/>
                                                <ice:outputText rendered="#{homePage.groupName == 'Released Dataverses' and homePage.isAlphaSort == false}"
                                                                value=" Studies"/>
                                                <ice:outputText escape="false"
                                                                rendered="#{homePage.groupName == 'Released Dataverses' and homePage.isAlphaSort == false}"
                                                                value=", "/>
                                                <ice:outputText rendered="#{homePage.groupName == 'Released Dataverses' and homePage.isAlphaSort == false }"
                                                                styleClass="dvn_totalsValue"
                                                                value="#{homePage.fileCount}"/>
                                                <ice:outputText rendered="#{homePage.groupName == 'Released Dataverses' and homePage.isAlphaSort == false }"
                                                                value=" Files" />
                                            </ice:outputLink>
                                        </div>
                                        
                                        <div jsfc="ice:panelGroup" style="float:right; background:#526F76;" id="createStudy" 
                                             styleClass="dvhmpgactionbox" rendered="#{VDCSession.loginBean.user!=null and !VDCRequest.readOnlyDatabase}" >
                                            <ice:outputLink value="/dvn/faces/admin/ChooseDataverseForCreateStudy.xhtml" rendered="#{VDCSession.loginBean.user!=null and !VDCRequest.readOnlyDatabase}">
                                                <ice:outputText value="Create a Study"/>
                                            </ice:outputLink>
                                        </div>
                                    </div>
                                        
                                    Study is a container for data files and cataloging information describing the data. It can also contain complementary files, such as documentation or code related to the data.
                                </div>
                                <div style="margin-top:1em; border-bottom: 1px solid #526F76;">
                                    <div style="color:#526F76; text-transform:uppercase;">Recently Released Studies</div>
                                    <ice:dataTable rows="10" headerClass="list-header" id="studyListTable1" width="100%"
                                                styleClass="dvnHmpgStudyWidgetTable" value="#{homePage.recentStudies}" var="studyUI">
                                        <ice:column id="column1">
                                            <div jsfc="ice:panelGroup" styleClass="#{!studyUI.study.restricted ? 'dvn_nostyle' : (studyUI.studyRestricted ? 'dvnStudyRestricted' : 'dvnStudyPublic')}" id="groupPanel1">
                                                <ice:outputLink styleClass="dvnInlineHelpTip" id="hyperlink3" value="/dvn/dv/#{studyUI.study.owner.alias}/faces/study/StudyPage.xhtml?globalId=#{studyUI.study.globalId}"
                                                                title="#{studyUI.metadata.title} - Dataverse Title: #{studyUI.study.owner.name} &lt;br/&gt; Release Date: #{studyUI.releaseTime}">
                                                    <ice:graphicImage styleClass="dvnHmpgStudyFileIcon" url="/resources/images/icon_analyze.gif" title="View and Analyze study files" rendered="#{studyUI.files and studyUI.subsettable}"/>
                                                    <ice:graphicImage styleClass="dvnHmpgStudyFileIcon" url="/resources/images/icon_files.gif" title="View study files" rendered="#{studyUI.files and !studyUI.subsettable}"/>
                                                    <ice:outputText style="display:inline; font-size:90% !important;" id="hyperlink3aText" value="#{studyUI.metadata.title}"/><ice:outputText style="display:inline;" id="hyperlink3bText" styleClass="dvnStudyListStudyAuthor" value=" by #{studyUI.authors}" rendered="#{studyUI.authors != null and studyUI.authors != ''}"/>
                                                </ice:outputLink>
                                            </div>
                                        </ice:column>
                                    </ice:dataTable>
                                    <div style="text-align:center; padding:3px 5px">
                                        <ice:outputLink value="/dvn/faces/StudyListingPage.xhtml?mode=100" id="hyperlinkBrowseStudiesReleased">
                                        <ice:outputText style="text-align:center; font-size:90% !important;" value="View More &gt;"/>
                                        </ice:outputLink>
                                        </div>
                                </div>
                                <div style="margin-top:1em; border-bottom: 1px solid #526F76;">
                                    <div style="color:#526F76; text-transform:uppercase;">Most Downloaded Studies</div>
                                    <ice:dataTable rows="10" headerClass="list-header" id="studyListTable2" width="100%"
                                                styleClass="dvnHmpgStudyWidgetTable" value="#{homePage.mostDownloadedStudies}" var="studyUI">
                                        <ice:column id="column1">
                                            <div jsfc="ice:panelGroup" styleClass="#{!studyUI.study.restricted ? 'dvn_nostyle' : (studyUI.studyRestricted ? 'dvnStudyRestricted' : 'dvnStudyPublic')}" id="groupPanel1">                 
                                                <ice:outputLink styleClass="dvnInlineHelpTip" id="hyperlink3" value="/dvn/dv/#{studyUI.study.owner.alias}/faces/study/StudyPage.xhtml?globalId=#{studyUI.study.globalId}"
                                                                title="#{studyUI.metadata.title} - Dataverse Title: #{studyUI.study.owner.name}  &lt;br/&gt; Download Count: #{studyUI.downloadCount}">
                                                    <ice:graphicImage styleClass="dvnHmpgStudyFileIcon" url="/resources/images/icon_analyze.gif" title="View and Analyze study files" rendered="#{studyUI.files and studyUI.subsettable}"/>
                                                    <ice:graphicImage styleClass="dvnHmpgStudyFileIcon" url="/resources/images/icon_files.gif" title="View study files" rendered="#{studyUI.files and !studyUI.subsettable}"/>
                                                    <ice:outputText style="display:inline; font-size:90% !important;" id="hyperlink3aText" value="#{studyUI.metadata.title}"/><ice:outputText style="display:inline;" id="hyperlink3bText" styleClass="dvnStudyListStudyAuthor" value=" by #{studyUI.authors}" rendered="#{studyUI.authors != null and studyUI.authors != ''}"/>
                                                </ice:outputLink>
                                            </div>
                                        </ice:column>
                                    </ice:dataTable>
                                    <div style="text-align:center; padding:3px 5px">
                                        <ice:outputLink value="/dvn/faces/StudyListingPage.xhtml?mode=100&amp;sort=downloaded" id="hyperlinkBrowseStudiesDownloaded">
                                        <ice:outputText style="text-align:center; font-size:90% !important;" value="View More &gt;"/>
                                        </ice:outputLink>
                                        </div>
                                </div>
                            </div>
                            <!-- Studies End -->
                    </div>
                    <!-- Dataverses + Studies Containter End -->
                    
                    <script type="text/javascript">
                        // <![CDATA[
                        // javascript for the accordion
                        jQuery(document).ready(function(){
                            jQuery('.xtraMenu ul ul').hide();
                            
                            classificationsMenu();
                        });
                        
                        function classificationsMenu() {
                            jQuery('.xtraMenu h4.head').bind('click', function(){
                                jQuery(this).toggleClass('selected');
                                jQuery(this).next().toggle();
                            })
                        };
                        
                        // Removed accordion code
                        
                        // Move toggleMoreInfo to BrowseDataversesPage
                        
                        function toggleMoreInfo(moreInfo) {
                            jQuery(moreInfo).next().slideToggle(500);
                            var toggleLabelText = (jQuery(moreInfo).children('span.iceOutTxt').text() == 'View Info [+]') ? 'Collapse Info [-]' : 'View Info [+]';
                            jQuery(moreInfo).children('span.iceOutTxt').text(toggleLabelText);
                            return false;
                        };
                        // ]]>
                    </script>
                    
                </ice:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
